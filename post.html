<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Entry</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="wrap header">
    <div>
      <h1 class="site-title"><a class="plain" href="index.html">My Writing</a></h1>
      <p class="site-subtitle">An archive of entries.</p>
    </div>
    <nav class="nav">
      <a href="index.html">Entries</a>
      <a class="active" href="post.html?id=about">About</a>
    </nav>
  </header>

  <main class="wrap">
    <article class="card">
      <a class="back" href="index.html">← Back to entries</a>
      <h2 id="title" class="entry-title"></h2>
      <div class="entry-meta">
        <span id="date" class="date"></span>
        <span id="tags" class="tags"></span>
      </div>
      <div id="content" class="entry-content"></div>
    </article>

    <footer class="footer">
      <small>© <span id="year"></span> My Writing</small>
    </footer>
  </main>

  <script src="posts.js"></script>
  <script>
    const yearEl = document.getElementById("year");
    yearEl.textContent = new Date().getFullYear();

    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    const post = posts.find(p => p.id === id);
    const titleEl = document.getElementById("title");
    const dateEl = document.getElementById("date");
    const tagsEl = document.getElementById("tags");
    const contentEl = document.getElementById("content");

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&","&amp;").replaceAll("<","&lt;")
        .replaceAll(">","&gt;").replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    if (!post) {
      document.title = "Not found";
      titleEl.textContent = "Entry not found";
      contentEl.innerHTML = `<p class="muted">That entry doesn’t exist yet.</p>`;
    } else {
      document.title = post.title + " — My Writing";
      titleEl.textContent = post.title;
      dateEl.textContent = new Date(post.written).toLocaleDateString("en-GB", { day:"2-digit", month:"long", year:"numeric" });
      tagsEl.innerHTML = (post.tags||[]).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("");

      // Content supports simple paragraphs split by blank lines
      const paragraphs = (post.body || "").split(/\n\s*\n/).map(p => p.trim()).filter(Boolean);
      contentEl.innerHTML = paragraphs.map(p => `<p>${escapeHtml(p).replaceAll("\n","<br>")}</p>`).join("");
    }
  </script>
</body>
</html>
