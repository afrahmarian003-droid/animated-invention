<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Entry</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="wrap header">
    <div>
      <h1 class="site-title">Entry</h1>
      <p class="site-subtitle">Entries from our journal.</p>
    </div>
 <nav class="nav">
  <a class="active" href="index.html">Entries</a>
<a href="about.html">About</a>

  <div class="dropdown">
    <button class="dropbtn">Submissions ▾</button>
    <div class="dropdown-content">
      <a href="mailto:STU255610@ardenuniversity.ac.uk?subject=Entry%20Submission%20-%20Julian">Julian</a>
      <a href="mailto:STU255610@ardenuniversity.ac.uk?subject=Entry%20Submission%20-%20Gloria">Gloria</a>
      <a href="mailto:STU255610@ardenuniversity.ac.uk?subject=Entry%20Submission%20-%20Marian">Marian</a>
      <a href="mailto:STU255610@ardenuniversity.ac.uk?subject=Entry%20Submission%20-%20Ian">Ian</a>
      <a href="mailto:STU255610@ardenuniversity.ac.uk?subject=Entry%20Submission%20-%20Zeynep">Zeynep</a>
      <a href="mailto:STU255610@ardenuniversity.ac.uk?subject=Entry%20Submission%20-%20Tristan">Tristan (honorary)</a>
    </div>
  </div>
</nav>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="controls">
        <input id="search" class="input" type="search" placeholder="Search entries…" autocomplete="off" />
        <select id="tagFilter" class="input">
          <option value="">All tags</option>
        </select>
      </div>
      <div id="list" class="list"></div>
    </section>

    <footer class="footer">
      <small>© <span id="year"></span> My Writing</small>
    </footer>
  </main>

  <script src="posts.js"></script>
  <script>
    const yearEl = document.getElementById("year");
    yearEl.textContent = new Date().getFullYear();

    const listEl = document.getElementById("list");
    const searchEl = document.getElementById("search");
    const tagFilterEl = document.getElementById("tagFilter");

    // Build tag dropdown
    const allTags = Array.from(new Set(posts.flatMap(p => p.tags || []))).sort((a,b)=>a.localeCompare(b));
    for (const t of allTags) {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      tagFilterEl.appendChild(opt);
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&","&amp;").replaceAll("<","&lt;")
        .replaceAll(">","&gt;").replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function render() {
      const q = searchEl.value.trim().toLowerCase();
      const tag = tagFilterEl.value;

      // Sort newest first by "written" date
      const filtered = posts
        .slice()
        .sort((a,b) => new Date(b.written) - new Date(a.written))
        .filter(p => {
          const hay = `${p.title} ${p.excerpt} ${(p.tags||[]).join(" ")}`.toLowerCase();
          const matchesSearch = !q || hay.includes(q);
          const matchesTag = !tag || (p.tags||[]).includes(tag);
          return matchesSearch && matchesTag;
        });

      if (!filtered.length) {
        listEl.innerHTML = `<p class="muted">No entries found.</p>`;
        return;
      }

      listEl.innerHTML = filtered.map(p => `
        <article class="post-row">
          <div class="post-meta">
            <div class="date">${new Date(p.written).toLocaleDateString("en-GB", { day:"2-digit", month:"short", year:"numeric" })}</div>
            <div class="tags">${(p.tags||[]).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}</div>
          </div>
          <div class="post-main">
            <h2 class="post-title">
              <a href="post.html?id=${encodeURIComponent(p.id)}">${escapeHtml(p.title)}</a>
            </h2>
            <p class="post-excerpt">${escapeHtml(p.excerpt || "")}</p>
          </div>
        </article>
      `).join("");
    }

    searchEl.addEventListener("input", render);
    tagFilterEl.addEventListener("change", render);
    render();
  </script>
</body>
</html>
